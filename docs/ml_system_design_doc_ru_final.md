_Общие назначения проекта можно найти в папке 'definition'_

# Документ по проектированию ML-системы - Productive Social

## 1. Зачем разрабатывать продукт?
Бизнес-цель Productive Social — стать окончательной «Операционной системой для себя». Наша миссия — выйти за рамки простого отслеживания и создать интеллектуальную экосистему, способную к глубокому анализу поведения. Синтезируя данные из различных инструментов повышения продуктивности, система выявляет индивидуальные паттерны привычек, как конструктивные, так и деструктивные, предоставляя пользователям гиперперсонализированные отчеты и рекомендации, которые можно сразу применять.

- Конкурентные преимущества:
    - Интеграция — объединяет систему целей и привычек, управление задачами, заметки и инструменты фокусировки в единый рабочий поток, обеспечивая сохранность данных о продуктивности.
    - Индивидуальный ML — использует выделенный движок машинного обучения, обучающийся на уникальных данных пользователя.
    - Социальная ответственность — внедряет специализированный социальный слой, созданный для повышения удержания пользователей через «доказательство выполненной работы» и совместные вехи, что позволяет изучать комбинации привычек и прогресс высокоэффективных пользователей.

## 2. Бизнес-требования
#### 2.1 Основные требования к продукту
- _Объединенный набор инструментов для повышения продуктивности_ — платформа должна предоставлять четыре основных автономных модуля — _Управление задачами, Заметки, Таймер Помодоро и Ведение дневника_, которые могут функционировать как независимо, так и в полностью интегрированной экосистеме.
- _Ориентация на цели_ — все действия пользователя должны соотноситься с долгосрочными целями.
- _Работа в оффлайн-режиме_ — все основные функции повышения продуктивности должны оставаться полностью функционирующими без интернета. Синхронизация с облаком и социальные функции должны происходить беспрепятственно при восстановлении соединения.
- _Обратная связь на основе данных_ — система должна собирать анонимизированные поведенческие данные из трех основных модулей для генерации «умных» записей в дневнике и отчетов о продуктивности.

| Функция                             | Описание требования                                                                                                                                                                                                                    |
|:------------------------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Экосистема целей и привычек**     | Иерархическая система, где **Задачи** соотносятся с **Долгосрочными целями**. Включает нативный **Отслеживатель привычек** (повторяющиеся триггеры, серии, логика частотности), чтобы ежедневные действия соответствовали общим целям. |
| **Заметки**                         | Поддержка богатого текста (Markdown), прикрепление изображений и связывание заметок с конкретными задачами, привычками или целями.                                                                                                     |
| **Таймер Помодоро**                 | Настраиваемые интервалы фокусировки/перерывов с возможностью «метки» фокусных сессий для конкретных привычек или задач, связанных с целями.                                                                                            |
| **Богатое ведение дневника**        | Ручные ежедневные записи в сочетании с **Контекстуальными метаданными** (автоматическая вставка выполненных привычек, отмеченных задач и времени концентрации).                                                                        |
| **Социальный поток продуктивности** | Публичные профили с **"Планами успеха"** и лентой на основе вех для оценки прогресса и вдохновения на стыковку привычек.                                                                                                               |

## Ограничения
- Затраты на инфраструктуру: проект должен минимизировать зависимость от дорогостоящих облачных платформ (например, AWS, GCP). Архитектура должна отдавать предпочтение недорогим или open-source решениям, где возможно.
- Обработка на устройстве: чтобы соответствовать требованию «Работа в оффлайн-режиме» и снизить затраты на серверы, inference ML для ведения дневника лучше выполнять на устройстве пользователя.
- Распространение: запуск ограничен Google Play (Android) и Apple App Store (iOS) для начальной пилотной фазы.

#### Пилотный бизнес-процесс (интеграция ML)
Модель ML — не отдельная функция, а связующее звено пользовательского опыта.
- _Агрегация данных_ — приложение постоянно логирует взаимодействия в модулях Цели, Задачи, Помодоро и Заметки.
- _Ежедневный синтез_ — каждые 24 часа модель ML обрабатывает эти логи для формирования «Умной» записи в дневнике.
- _Восстановление отсутствия активности_ — если пользователь неактивен более 2 дней, система выполняет «предиктивное заполнение» (предсказывает, что пользователь, вероятно, сделал), что позволяет сохранять серию и исторический архив с минимальными усилиями пользователя.

#### Критерии успеха
Хотя конечная цель — полноценная работа приложения, успех будем измерять по следующим показателям:
1. Точность и полезность ML — уровень принятия черновиков дневника, сгенерированных ML, должен превышать 60%.
    - Ошибка предсказания (разница между предсказанными задачами и исправлениями пользователя) должна снижаться за 30 дней по мере обучения модели.
2. Удержание пользователей — заметное увеличение числа активных пользователей, особенно за счет социального фида и желания поддерживать публичные планы.
3. Целостность данных — беспрепятственная синхронизация данных между всеми модулями приложения.

## 3. Объем проекта
- В рамках:
    - Полная интеграция четырех модулей;
    - Прогнозирующее ML;
    - Оценка продуктивности пользователя;
    - Офлайн-ориентированная синхронизация — локальное хранение базы данных с бесшовной синхронизацией с облаком.

- Вне рамок:
    - Прямые сообщения (DM): для предотвращения отвлечений и сохранения фокуса.
    - Общий социальный контент: без обновлений статуса или медиа, не связанного с продуктивностью или целями.
    - Интеграция со сторонними сервисами: синхронизация с внешними инструментами (Notion, Google) откладывается на пост-MVP.

## 4. Предположения по решению

| Объект       | Описание                                                     | Связь                                                                  |
|:-------------|:-------------------------------------------------------------|:-----------------------------------------------------------------------|
| **Цель**     | Высокоуровневая задача (например, «Выучить Python»).         | Имеет много привычек и задач.                                          |
| **Привычка** | Повторяющиеся паттерны поведения (например, «Кодить 1 час»). | Связана с целью; генерирует «Логи».                                    |
| **Задача**   | Одноразовые действия (например, «Установить VS Code»).       | Связана с целью или конкретной привычкой.                              |
| **Сессия**   | Метаданные из **Таймера Помодоро**.                          | Относится к задаче или привычке; подтверждает «Доказательство работы». |
| **Дневник**  | Синтез всех данных за конкретную дату.                       | Объединяет все сессии, привычки и задачи.                              |

#### Производительность модели
_Производительность inference_ — генерация дневника должна занимать не более 30 секунд для обеспечения плавного пользовательского интерфейса.  
_Роль пользователя_ — пользователь является конечным редактором. ML предоставляет черновик; пользователь проверяет, редактирует или удаляет.  
_Обоснование_ — Полностью автоматизированный личный дневник философски невозможен — субъективное отражение пользователя — самая важная часть процесса.

### 5. Постановка задачи
Создать ML/LLM pipeline, который автоматически синтезирует ежедневную активность пользователя в рефлексивный «Умный дневник» по следующему сценарию:
1. _Извлечение объектов и событий_ — определить завершенные задачи, общее время фокусировки и настроение из заметок.
2. _Корреляция поведения_ — связать эти события с установленными целями и привычками для расчета прогресса.
3. _Генеративный синтез_ — сформировать структурированный рассказ, выделяющий достижения, выявляющий узкие места и предлагающий улучшения на следующий день.
4. _Заполнение пробелов_ — предиктивно заполнить пропущенные дни, используя исторические шаблоны вероятностей.  
   _Тип задачи_ — извлечение данных -> нормализация -> генерация рассказа.

#### Подготовка данных
Для обучения предсказательных моделей используют все функции приложения:

| Тип функции        | Название атрибута   | Источник          | Обработка / инженерия                                                                                          |
|:-------------------|:--------------------|:------------------|:---------------------------------------------------------------------------------------------------------------|
| **Цель**           | `user_satisfaction` | Редакции дневника | Бинарный: 1, если пользователь сохранил черновик с менее чем 20% изменений, 0 — при сильных правках/удалениях. |
| **Текст**          | `note_content`      | Модуль заметок    | Очистка -> Sentiment Analysis (NLP) -> Встраивание.                                                            |
| **Числовые**       | `focus_efficiency`  | Логи Pomodoro     | Доля (запланированных Pomodoro / выполненных Pomodoro).                                                        |
| **Категориальные** | `goal_sector`       | Модуль целей      | One-Hot Encoding (например, Карьера, Здоровье, Хобби).                                                         |
| **Временные**      | `activity_pattern`  | Логи событий      | Расчет «часов пиковой продуктивности» (время суток vs. завершение задач).                                      |

## 6. Блок-схема решения
[Блок-схема решения](https://drive.google.com/file/d/1d9CVSUS3K3sv02dq-EpMQfZmihcB6Cln/view?usp=sharing)

## Этапы решения задачи

### 1. Этапы подготовки данных

#### 1.1 Подготовка данных
Для ProductiveSocial необходимые данные для предобучения модели — общедоступные датасеты о паттернах человеческой продуктивности. Большинство таких датасетов сосредоточены на офисных работниках, поэтому для уменьшения смещения можно включить разнообразные синтетические данные, представляющие студентов, фрилансеров и ночных сменщиков.

Основные категории внешних данных для предобучения:
- Поведенческие логи: датасеты вроде 90-дневного трекера привычек или Kaggle по тайм-менеджменту. Они показывают корреляции между сном, физической активностью и самооценкой продуктивности.
- Доказательства работы (носимые устройства): датасеты Fitbit, PMData. Используются для обучения модели распознавать «активные» и «сидячие» периоды как прокси для фокуса.
- Текстовые сводки: публичные подсказки для ведения дневника и блоги «День из жизни» (собраны с Reddit/forum продуктивности) для обучения LLM желаемому стилю повествования.

Основной источник данных — пользовательские данные.
#### 1.2 Источники и генерация данных
- Внешние: Kaggle и open-source репозитории (например, PMData).
- Внутренние: генерируемые на устройстве данные из модулей приложения.
- Синтетические: использование LLM для генерации синтетических отчетов о продуктивности для увеличения обучающего набора.

#### 1.3 Конфиденциальность и приватность
Перед синхронизацией данных с сервером необходимо использовать локальный слой Named Entity Recognition (NER), чтобы удалить номера телефонов и конкретные локации.

### 2. Разработка модели и персонализация
#### 2.1 Стратегия предобучения + дообучения
1. Глобальное предобучение: обучение небольшой языковой модели (SLM) на внешних и синтетических данных для понимания структуры дневниковых записей.
2. Персонализация на устройстве (дообучение): по мере редактирования пользователем «Умного дневника» модель выполняет локальную адаптацию с помощью LoRA, подстраивая веса под конкретный словарь и приоритеты пользователя.

#### 2.2 Метрики ML
- Функция потерь — взвешенная кросс-энтропия (с приоритетом правильного определения задач, связанных с целями).
- Основная метрика — расстояние редактирования (Levenshtein). Разница между черновиком ML и финальной версией пользователя.
- Цель: среднее расстояние редакции должно снижаться на 15% каждый месяц.

#### 2.3 Валидация ML
Используем схему "User-Fold" кросс-валидации:
- Обучение на 100 «персонажах» (моделируемых пользователях).
- Тестирование на 20 «отложенных» персонажах, чтобы убедиться, что модель обобщается на разные стили жизни, ещё до реальных пользователей.

#### 2.4 Базовое vs. Продвинутое решение
- Базовое — правило на основе шаблонов (например, «Вы завершили 3 задачи сегодня»).
- Продвинутое — дообученная SLM, которая может распознавать настроение (например, «Несмотря на длинные встречи, вы сохраняли фокус на проекте Python»).

### 3.Inference и оптимизация модели
Поскольку предполагается оффлайн-режим, модель не должна зависеть от облачных GPU. Необходимо максимально уменьшить размер модели для работы на мобильных устройствах.

#### 3.1 Квантование и сжатие модели
- Для размещения SLM типа Phi-3 или Gemma-2b на смартфоне нужно снизить размер модели.
- Техника: квантование в 4 бита (GGML, bitsandbytes). Это уменьшит модель с ~5 ГБ до примерно 1.2–1.8 ГБ.
- Формат: преобразование в TFLite (Android) или CoreML (iOS) для использования аппаратного ускорения.
- Расчет памяти: Memory ≈ (Parameters * Bits)/8. Для модели с 2 миллиардами параметров — около 1 ГБ VRAM.

#### 3.2 Триггеры запуска inference
Запуск генеративной модели — ресурсоемкая операция, поэтому:
- Плановый запуск — раз в 24 часа, в выбранное пользователем время или ночью при зарядке.
- По запросу — при ручном вызове пользователем.

### 4. Бизнес-правила
Результат ML необходимо фильтровать через «Бизнес-правила», чтобы обеспечить помощь, безопасность и соответствие философии "Productive Social".

#### Правило 1
Если вероятность (confidence score) предсказания задачи ниже 0.4, система не должна автоматически заполнять пробел, а предложить пользователю:
«Обнаружена пробел в логах — работали ли вы над (цель x) в (указанный день)?»

#### Правило 2
ML никогда не должен предлагать удаление цели или привычки. Можно предлагать идеи по улучшению или корректировке. Модель должна выступать в роли поддерживающего коуча, а не судьи.

#### Правило 3
Перед созданием социального «Плана успеха» слой правил обеспечивает:
- Удаление всех числовых идентификаторов (номеров телефонов, адресов).
- Замена конкретных названий проектов на общие теги «Сектор» (например, «Секретный проект X» → «Разработка программного обеспечения»).

### 5. Итоговый отчет и бизнес-метрики
| Метрика                      | Цель | Способ измерения                                                                  |
|------------------------------|------|-----------------------------------------------------------------------------------|
| Снижение усилий пользователя | >50% | Сравнение времени на ручной дневник и редактирование AI-черновика.                |
| Задержка inference           | <15с | P95 времени от «Триггера» до «Отображения черновика».                             |
| Удержание привычек           | +15% | Успех 14-дневных серий у пользователей по сравнению с контрольной группой без ML. |

### 6. Реализация и запуск в производство

#### 8.1 Архитектура решения
- Локальный слой: Kotlin/Swift приложение с TFLite/CoreML для inference.
- Облачный слой: микросервисы на GoLang для управления социальным фидом и хранения анонимизированных «Планов успеха».

#### 8.2 Инфраструктура и масштабируемость
- Стек: AWS Lambda для синхронизации метаданных; PostgreSQL для соцданных.
- Почему: серверлесс — автоматически масштабируется и соответствует требованию «низких затрат».

#### 8.3 Безопасность и конфиденциальность данных
- GDPR: пользователи имеют право на удаление данных (одним кликом стираются локальные и удаленные данные). Вся личная информация не передается в облако для ML.
- NER слой: анонимизация текста перед соцразделением, чтобы избежать случайного раскрытия названий проектов или контактов.

#### 8.4 Риски и их минимизация
| Риск             | Влияние | Стратегия минимизации                                                                     |
|------------------|---------|-------------------------------------------------------------------------------------------|
| Сдвиг модели     | Средне  | Периодическая переобучение на устройстве (LoRA).                                          |
| Разрядка батареи | Высокая | Ограничение тяжелого inference/обучения при зарядке.                                      |
| Галлюцинации     | Высокие | Использование «Правила 1» (порог доверия), чтобы избегать ложных предсказаний активности. |

---